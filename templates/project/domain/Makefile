##########################################################################
# This is the project's Makefile.
##########################################################################

##########################################################################
# VARIABLES
##########################################################################

HOME := $(shell echo ~)
PWD := $(shell pwd)
ENV := ENV_FILE=env
ENV_TEST := ENV_FILE=env.test
PYTHON := venv/bin/python

##########################################################################
# MENU
##########################################################################

.PHONY: help
help:
	@awk 'BEGIN {FS = ":.*?## "} /^[0-9a-zA-Z_-]+:.*?## / {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}' $(MAKEFILE_LIST)

##########################################################################
# SETUP
##########################################################################

.PHONY: create-venv
create-venv: ## create the virtual environment
	python3 -m venv $(PWD)/venv

##########################################################################
# TEST
##########################################################################

.PHONY: test
test: ## run test suite
	$(ENV_TEST) $(PYTHON) -m unittest discover src

##########################################################################
# COMMANDS
##########################################################################

.PHONY: run-task
run-task: ## run a task (uses TASK, ARGS)
	@$(ENV) $(PYTHON) src/run_task.py $(TASK) --args "$(ARGS)"
